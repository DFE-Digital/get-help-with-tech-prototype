{% extends "layout.html" %}
{% set title = "Your schools" %}
{% set devicesAllocated = 0 %}
{% for item in data.schools %}
  {% set devicesAllocated = devicesAllocated + item.total %}
{% endfor %}
{% set devicesAvailableToOrder = devicesAllocated - data.devicesOrdered %}
{% set routersAvailableToOrder = data.routersAllocated - data.routersOrdered %}
{% if devicesAvailableToOrder > 0 %}
  {% set showOrderButton = 'canOrder' %}
{% endif %}
{% block pageTitle %}{{ title }}{% endblock %}

{% block pageNavigation %}
  {% set customBreadcrumbTitle = title %}
  {% include '_shared/breadcrumbs/_get-laptops-and-tablets.html' %}
{% endblock %}

{% block content %}
{% set missingSchools %}
  {% if not data.trust %}
    <p>This is a list of all local authority maintained and special schools.</p>
  {% endif %}
  <p>Email <a href="#">COVID.TECHNOLOGY@education.gov.uk</a> and tell us what to change.</p>
{% endset %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">
      {{ title }}
    </h1>
    {% include '_shared/responsible-body/_group-items-available.html' %}
  </div>
</div>

<div data-module="filterable-table">
  {% if data.schools.length > 10 %}
  <!-- <div class="app-filter-container">
    <h2 class="govuk-heading-m">Filter this list</h2>

    <div style="background-color: #fff; padding: 10px">
      {{ govukCheckboxes({
        fieldset: {
          legend: {
            text: 'Status',
            classes: 'govuk-fieldset__legend--s'
          }
        },
        items: [
          { text: 'Needs information' },
          { text: 'Needs a contact' },
          { text: 'School contacted' },
          { text: 'Orders open' }
        ]
      }) }}

      {{ govukRadios({
        fieldset: {
          legend: {
            text: 'Who will order?',
            classes: 'govuk-fieldset__legend--s'
          }
        },
        items: [
          { text: 'Show all' },
          { text: 'Trust' },
          { text: 'School' }
        ]
      }) }}

      {{ govukButton({
        html: 'Filter list',
        classes: 'govuk-!-margin-bottom-0'
      }) }}
    </div>
  </div> -->

  <!-- <form class="app-filter-container">
    <div class="govuk-form-group govuk-!-margin-top-1 govuk-!-margin-bottom-4">
      <label class="govuk-label govuk-label--s" for="filter">
        Filter the list of schools
      </label>
      <div id="account-number-hint" class="govuk-hint">
        Try searching for “Secondary” or a status like “Needs a contact”
      </div>
      <input class="govuk-input js-filter-table-input" id="filter" name="filter" type="text">
    </div>
  </form> -->
  {% endif %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds govuk-!-margin-top-4">
    <h2 class='govuk-heading-m govuk-!-margin-bottom-2'>
      Schools and their allocated devices
    </h2>
    {{ govukDetails({
      summaryText: "Is this list wrong?",
      html: missingSchools,
      classes: 'govuk-!-margin-bottom-2'
    }) }}
  </div>
</div>

  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th class="govuk-table__header" style="width: 50%">School</th>
        <th class="govuk-table__header">Allocation</th>
        <th class="govuk-table__header">Who will order?</th>
        <th class="govuk-table__header" style="width: 200px">Status</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for school in data.schools %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            <a href="/responsible-body/devices/schools/{{ school.URN }}" class="js-open-on-submit">{{ school.name }} ({{ school.URN }})</a><br />
            {% if school.type == 'Special schools' %}
              Special school
            {% else %}
              {{ school.phase }}
            {% endif %}
          </td>
          <td class="govuk-table__cell">
            {{ school.total }} devices <br>
            0 routers
          </td>
          <td class="govuk-table__cell">
            {% if data['responsible-body'][school.URN].who %}
              {% if data['responsible-body'][school.URN].who == 'central' %}
                {% if data.trust %}Trust{% else %}Local authority{% endif %}
              {% elseif data['responsible-body'][school.URN].who == 'school' %}
                School
              {% else %}
                Unknown
              {% endif %}
            {% else %}
              {{ whoOrders }}
            {% endif %}
          </td>
          <td class="govuk-table__cell">
            {% set urn = school.URN %}
            {% include 'responsible-body/devices/school/_status-tag.html' %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
